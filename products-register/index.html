<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل الأصناف</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%232D0B59' width='32' height='32' rx='6'/><text x='16' y='22' font-family='serif' font-size='18' font-weight='bold' fill='%23C9A7FF' text-anchor='middle'>F</text></svg>" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="app-body">
  <aside class="app-sidebar" id="sidebar">
    <div class="sidebar-header">
      <span class="sidebar-brand">تسجيل الأصناف</span>
      <p class="sidebar-sub">أصناف مع الحجم والسعر</p>
    </div>
    <nav class="sidebar-nav">
      <a href="index.html" class="sidebar-link active">
        <i class="bi bi-box-seam"></i>
        <span>الأصناف</span>
      </a>
      <a href="../1/index.html" class="sidebar-link">
        <i class="bi bi-box-arrow-in-left"></i>
        <span>الموقع الرئيسي</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a href="https://wa.me/972501234567" class="sidebar-wa" target="_blank" rel="noopener">
        <i class="bi bi-whatsapp"></i>
        واتساب
      </a>
    </div>
  </aside>

  <button type="button" class="sidebar-toggle d-lg-none" id="sidebarToggle" aria-label="القائمة">
    <i class="bi bi-list"></i>
  </button>

  <main class="app-main">
    <header class="app-header">
      <h1 class="app-title">تسجيل الأصناف</h1>
      <p class="app-desc">إضافة أصناف مع الحجم وسعر كل حجم</p>
    </header>

    <section class="products-form-card">
      <h2 class="products-form-title"><i class="bi bi-plus-circle"></i> إضافة صنف جديد</h2>
      <form id="productForm" class="products-form">
        <div class="form-group">
          <label for="productName">اسم الصنف</label>
          <input type="text" id="productName" class="form-control" placeholder="مثال: صندوق الكوكيز" required>
        </div>

        <div class="sizes-section">
          <div class="sizes-header">
            <span class="sizes-label">الأحجام والأسعار</span>
            <button type="button" class="btn-add-size" id="addSizeBtn" aria-label="إضافة حجم">
              <i class="bi bi-plus-lg"></i> إضافة حجم
            </button>
          </div>
          <div class="sizes-rows" id="sizesRows">
            <div class="size-row">
              <input type="text" class="form-control size-name" placeholder="الحجم (مثال: صغير)" required>
              <input type="number" class="form-control size-price" placeholder="السعر (₪)" min="0" step="1" required>
              <button type="button" class="btn-remove-size" aria-label="حذف"><i class="bi bi-x-lg"></i></button>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-submit"><i class="bi bi-check2"></i> حفظ الصنف</button>
          <button type="reset" class="btn-reset"><i class="bi bi-arrow-counterclockwise"></i> إعادة</button>
        </div>
      </form>
    </section>

    <section class="products-list-section">
      <h2 class="products-list-title">الأصناف المسجّلة</h2>
      <div class="products-list" id="productsList"></div>
      <div class="products-empty" id="productsEmpty">
        <i class="bi bi-inbox"></i>
        <p>لا توجد أصناف مسجّلة بعد. أضف صنفاً من النموذج أعلاه.</p>
      </div>
    </section>
  </main>

  <div class="sidebar-overlay d-lg-none" id="sidebarOverlay" aria-hidden="true"></div>

  <script>
    (function () {
      var STORAGE_KEY = 'products-register-items';
      var toggle = document.getElementById('sidebarToggle');
      var sidebar = document.getElementById('sidebar');
      var overlay = document.getElementById('sidebarOverlay');
      if (toggle) {
        toggle.addEventListener('click', function () {
          sidebar.classList.toggle('sidebar-open');
          overlay.classList.toggle('show');
        });
      }
      if (overlay) {
        overlay.addEventListener('click', function () {
          sidebar.classList.remove('sidebar-open');
          overlay.classList.remove('show');
        });
      }

      function getProducts() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch (e) { return []; }
      }

      function saveProducts(list) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        } catch (e) {}
      }

      var sizesRows = document.getElementById('sizesRows');
      var addSizeBtn = document.getElementById('addSizeBtn');

      addSizeBtn.addEventListener('click', function () {
        var row = document.createElement('div');
        row.className = 'size-row';
        row.innerHTML =
          '<input type="text" class="form-control size-name" placeholder="الحجم (مثال: وسط)" required>' +
          '<input type="number" class="form-control size-price" placeholder="السعر (₪)" min="0" step="1" required>' +
          '<button type="button" class="btn-remove-size" aria-label="حذف"><i class="bi bi-x-lg"></i></button>';
        sizesRows.appendChild(row);
        row.querySelector('.btn-remove-size').addEventListener('click', function () { row.remove(); });
      });

      sizesRows.addEventListener('click', function (e) {
        if (e.target.closest('.btn-remove-size') && sizesRows.querySelectorAll('.size-row').length > 1) {
          e.target.closest('.size-row').remove();
        }
      });

      var productForm = document.getElementById('productForm');
      productForm.addEventListener('submit', function (e) {
        e.preventDefault();
        var nameInput = document.getElementById('productName');
        var name = nameInput.value.trim();
        if (!name) return;

        var rows = sizesRows.querySelectorAll('.size-row');
        var sizes = [];
        for (var i = 0; i < rows.length; i++) {
          var r = rows[i];
          var sizeName = r.querySelector('.size-name').value.trim();
          var sizePrice = r.querySelector('.size-price').value;
          if (sizeName && sizePrice !== '' && Number(sizePrice) >= 0) {
            sizes.push({ size: sizeName, price: Number(sizePrice) });
          }
        }
        if (sizes.length === 0) {
          alert('أضف حجماً واحداً على الأقل مع السعر.');
          return;
        }

        var products = getProducts();
        products.push({
          id: Date.now(),
          name: name,
          sizes: sizes
        });
        saveProducts(products);
        renderProducts();
        productForm.reset();
        var firstRow = sizesRows.querySelector('.size-row');
        while (sizesRows.children.length > 1) sizesRows.lastElementChild.remove();
        firstRow.querySelector('.size-name').value = '';
        firstRow.querySelector('.size-price').value = '';
      });

      productForm.addEventListener('reset', function () {
        var rows = sizesRows.querySelectorAll('.size-row');
        for (var i = 1; i < rows.length; i++) rows[i].remove();
      });

      function renderProducts() {
        var list = document.getElementById('productsList');
        var empty = document.getElementById('productsEmpty');
        var products = getProducts();

        if (products.length === 0) {
          list.innerHTML = '';
          empty.style.display = 'block';
          return;
        }
        empty.style.display = 'none';

        list.innerHTML = products.map(function (p) {
          var sizesHtml = p.sizes.map(function (s) {
            return '<tr><td>' + escapeHtml(s.size) + '</td><td><strong>' + s.price + ' ₪</strong></td></tr>';
          }).join('');
          return (
            '<div class="product-card" data-id="' + p.id + '">' +
              '<div class="product-card-header">' +
                '<h3 class="product-card-name">' + escapeHtml(p.name) + '</h3>' +
                '<button type="button" class="btn-delete-product" data-id="' + p.id + '" aria-label="حذف"><i class="bi bi-trash"></i></button>' +
              '</div>' +
              '<table class="product-card-table">' +
                '<thead><tr><th>الحجم</th><th>السعر</th></tr></thead>' +
                '<tbody>' + sizesHtml + '</tbody>' +
              '</table>' +
            '</div>'
          );
        }).join('');

        list.querySelectorAll('.btn-delete-product').forEach(function (btn) {
          btn.addEventListener('click', function () {
            var id = Number(btn.getAttribute('data-id'));
            var products = getProducts().filter(function (p) { return p.id !== id; });
            saveProducts(products);
            renderProducts();
          });
        });
      }

      function escapeHtml(text) {
        var div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      renderProducts();
    })();
  </script>
</body>
</html>
